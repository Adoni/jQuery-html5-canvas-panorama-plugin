/*
 * ddpanorama - jQuery plugin version 1.12
 * Copyright (c) Tiny Studio (http://tinystudio.dyndns.org/)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 * Date: Wed Apr  4 09:42:51 KST 2012
 */

(function(a){var b={animations:[],timerId:-1,max_speed:43e3,drag_constant:1.6,cursorX:0,cursorY:0,currentTime:(new Date).getTime()};b.timerId=window.setInterval(function(){for(var a=0;a<b.animations.length;++a){b.animations[a].update()}},1e3/30);b.mousedown=function(a,c){b.cursorXOld=b.cursorX=a;b.cursorYOld=b.cursorY=c;b.speedX=0};b.mousemove=function(a,c){b.cursorXOld=b.cursorX;b.cursorYOld=b.cursorY;b.cursorX=a;b.cursorY=c;var d=(new Date).getTime();var e=(d-b.currentTime)/1e3;b.currentTime=d;b.speedX=(b.cursorX-b.cursorXOld)/e;if(b.speedX>b.max_speed)b.speedX=b.max_speed;if(b.speedX<-b.max_speed)b.speedX=-b.max_speed};b.event_prefix="ddpanorama_";a(document).bind("mousemove",function(a){b.mousemove(a.pageX,a.pageY)});a(document).bind("touchmove",function(a){b.mousemove(a.originalEvent.touches[0].pageX,a.originalEvent.touches[0].pageY)});a(document).bind("touchstart",function(a){b.mousedown(a.originalEvent.touches[0].pageX,a.originalEvent.touches[0].pageY)});a(document).bind("mousedown",function(a){b.mousedown(a.pageX,a.pageY)});a.fn.ddpanorama=function(c){return this.each(function(){if(a(this).data("ddpanorama")!=null)return;var d=a(this);var e=document.createElement("canvas");var f={img:d,canvas:e,mousedown:false,draw_scale:1,minSpeed:0};a(this).css("display","none");f.params=c;if(f.params==null)f.params={};f.add=function(){var a=b.animations.indexOf(this);if(a<0){b.animations.push(this)}};f.remove=function(){var a=b.animations.indexOf(this);if(a>=0){b.animations.splice(a,1)}};f.setScrollX=function(b){a(this.canvas).prop("scrollX",b);return b};f.scrollTo=function(b){var c=a(this.canvas).prop("mousedownScrollX");if(c==null)return;var e=a(d).get()[0].naturalWidth;this.setScrollX(c+b-a(this.canvas).prop("mousedownPageX"))};f.update=function(){var c=(new Date).getTime();var d=a(this.canvas).prop("updateTime");if(d==null)d=c;a(this.canvas).prop("updateTime",c);var e=(c-d)/1e3;var f=a(this.canvas).prop("scrollX");var g=a(this.canvas).prop("speedX");var h=this.canvas.getContext("2d");var i=a(this.img).get()[0].naturalWidth;this.setScrollX(f+e*g);g+=b.drag_constant*(this.minSpeed-g)*e;a(this.canvas).prop("speedX",g);this.redraw();if(Math.abs(g)<1&&this.minSpeed==0){this.stop();this.remove()}};f.stop=function(){a(this.canvas).prop("speedX",0)};f.redraw=function(){var c=a(this.img).get()[0].naturalWidth;var d=this.canvas.getContext("2d");var e=a(this.canvas).prop("scrollX");var f=e;e/=this.draw_scale;var g=false;if(isNaN(c)==false&&c!=0){while(e<-c)e+=c;while(e>=c)e-=c;var h=this.img.get()[0];d.setTransform(this.draw_scale,0,0,this.draw_scale,0,0);d.drawImage(h,e,0);d.drawImage(h,e+c,0);d.drawImage(h,e-c,0);g=true}else{d.setTransform(1,0,0,1,0,0);d.fillStyle="#000000";d.fillRect(0,0,this.canvas.width,this.canvas.height)}a(this.img).trigger(jQuery.Event(b.event_prefix+"redraw",{canvas:this.canvas,speed:a(this.canvas).prop("speedX")/b.max_speed,loaded:g}))};f.onmousedown=function(b){var c=this;var d=this.canvas;this.mousedown=true;a(d).prop("speedX",0);var e=(new Date).getTime();this.remove();this.stop();a(d).prop("mousedownPageX",b);a(d).prop("mousedownScrollX",a(d).prop("scrollX"));a(d).prop("updateTime",e)};f.resize=function(){var b=this.img;var c=this.canvas;var d=b.get()[0].naturalWidth;var e=b.get()[0].naturalHeight;if(this.params.hasOwnProperty("height")){e=this.params.height;this.draw_scale=e/b.get()[0].naturalHeight}else{this.params.draw_scale=1}if(this.params.hasOwnProperty("ratio")){d=e/this.params.ratio}else if(this.params.hasOwnProperty("width")){d=this.params.width}a(c).attr("width",d);a(c).attr("height",e)};a(this).data("ddpanorama",f);a(e).data("ddpanorama",f);a(e).prop("scrollX",0);a(e).prop("speedX",0);var g=function(c){var d=a(this).data("ddpanorama");if(d.mousedown==false)return;d.mousedown=false;d.add();var f=(new Date).getTime();var g=a(this).prop("updateTime");a(this).prop("updateTime",f);a(e).prop("speedX",b.speedX);a(e).prop("mousedownScrollX",null)};var h=0;var i=true;if(c.hasOwnProperty("minSpeed"))h=c.minSpeed;if(c.hasOwnProperty("interactive"))i=c.interactive;if(i){a(e).mousedown(function(b){var c=a(this).data("ddpanorama");c.onmousedown(b.pageX)});a(e).css("cursor","move");a(e).bind("mouseup",g);a(e).bind("mouseupoutside",g);a(e).bind("mousemove",function(b){var c=b.pageX;var d=a(this).data("ddpanorama");if(d.mousedown==false)return;d.scrollTo(c);d.redraw()});a(e).bind("contextmenu",function(a){a.preventDefault();return false});a(e).bind("touchstart",function(b){var c=a(this).data("ddpanorama");c.onmousedown(b.originalEvent.touches[0].pageX)});a(e).bind("touchmove",function(b){b.preventDefault();var c=a(this).data("ddpanorama");if(c.mousedown==false)return false;var d=b.originalEvent.touches[0].pageX;c.scrollTo(d);c.redraw()});a(e).bind("touchend",g)}f.minSpeed=h;if(h!=0){f.add()}f.resize();f.redraw();d.after(e);a(this).load(function(){f.resize();f.redraw()})})}})(jQuery)